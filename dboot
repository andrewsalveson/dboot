#!/bin/bash
VERSION="0.3"

# temporarily move into dboot folder
OLDWD=$(pwd)
cd ~/dboot
. ./console

echo -e "
              __
        _____/\\_\\     
 BLOK  /\\   / / /  HEAD
    __/_ \\  \\/_/ \\__     
   /\\___\\ \\_______\\_\\    
   \\/___/ / x   x /_/    
      \\  /  ___  /     
 BOOT  \\/_______/  BOT
       \\/_/       v${CYA}$VERSION${NRM}

   DONT BE A BLOK HEAD

"

TMP=~/dboot/tmp
mkdir -p $TMP
LOG=$TMP/log.sh

# build temp and log (replay) script
if [ -f $LOG ]; then
  rm $LOG
fi
echo "#!/bin/bash" >> $LOG
chmod +x $LOG

info "OS: $OSTYPE"
set +a
if [[ "$OSTYPE" == "linux-gnu" ]]; then
  source ./dboot-unix-derivative
  source ./dboot-linux-gnu
elif [[ "$OSTYPE" == "linux-gnueabihf" ]]; then
  info "probably a Raspberry Pi"
  source ./dboot-unix-derivative
  source ./dboot-linux-gnueabihf
elif [[ "$OSTYPE" == "darwin"* ]]; then
  source ./dboot-unix-derivative
  source ./dboot-macos
elif [[ "$OSTYPE" == "msys" ]]; then
  source ./dboot-msys
elif [[ "$OSTYPE" == "cygwin" ]]; then
  fail "no scripts for cygwin"
elif [[ "$OSTYPE" == "freebsd"* ]]; then
  fail "no scripts for freebsd"
else
  fail "unknown OS"
fi

log "check repo status"
./git-check

source ./install
set -a

pass "dboot complete"

# return to original working directory
cd $OLDWD

